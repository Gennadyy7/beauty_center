{% extends 'main/layout.html' %}

{% block title %}Корзина{% endblock %}

{% block content %}
<main itemscope itemtype="http://schema.org/ShoppingCart">
    <h1 itemprop="name">Моя корзина</h1>

    {% if cat_obj_services_with_totals %}
        {% for category_total_pair, services in cat_obj_services_with_totals.items %}
            <section itemscope itemtype="http://schema.org/ItemList">
                <h2 itemprop="itemListOrder">Категория: {{ category_total_pair.0 }}</h2>
                <ul>
                    {% for service in services %}
                        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/Product">
                            <span itemprop="name">{{ service.title }}</span> - <span itemprop="price">{{ service.price }}</span>
                            <form action="{% url 'basket' %}" method="POST" itemscope itemtype="http://schema.org/Action">
                                {% csrf_token %}
                                <input type="hidden" name="to_delete" value="{{ service.id }}">
                                <button type="submit" aria-label="Удалить {{ service.title }}">-</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
                <h3>Цена: <span itemprop="totalPrice">{{ category_total_pair.1 }}</span></h3>
                <form action="{% url 'ordering' %}" method="GET">
                    {% csrf_token %}
                    <input type="hidden" name="category_name_from_basket" value="{{ services.0.service_specialization.service_category.name }}">
                    <button type="submit" aria-label="Оформить заказ">Оформить заказ</button>
                </form>
                <form action="{% url 'basket' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="to_delete" value="{{ category_total_pair.0 }}">
                    <button type="submit" aria-label="Удалить категорию {{ category_total_pair.0 }}">Удалить</button>
                </form>
            </section>
        {% endfor %}
    {% else %}
        <p>Ваша корзина пуста.</p>
    {% endif %}
</main>
{% endblock %}